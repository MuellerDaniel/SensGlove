\section{Pose Estimation} \label{sec:estimationRes}

\subsection{Identification of the Minimization Process} \label{subsec:resSim}

\subsubsection{Utilized Minimization Methods} \label{subsubsec:miniMethod}

The size and complexity of the minimization problem, as described in \ref{sec:estimation}, is dependent on how many finger states $ K $ should be estimated with which number of sensors $ N $. The beforehand introduced minimization problem \ref{eq:minimization} is stated here once again for clarity:
\begin{equation*} \label{eq:minimization}
\begin{aligned}
\underset{\mathrm{X}_K}{\text{minimize}} & & f(\mathrm{X}_K) \\
\text{subject to} & & 0 & \leq {x}_1(\theta_{\mathrm{MCP}}) & \leq & 1/2 \cdot \pi, \\
				  & & 0 & \leq {x}_1(\theta_{\mathrm{PIP}}) & \leq & 110/180 \cdot \pi, \\
				  & & -30/180 \cdot \pi & \leq {x}_1(\phi_{\mathrm{MCP}}) & \leq & 30/180 \cdot \pi, \\
				  & & 0 & \leq {x}_2(\theta_{\mathrm{MCP}}) & \leq & 1/2 \cdot \pi, \\
				  & & & \vdots \\
				  & & -30/180 \cdot \pi & \leq {x}_K(\phi_{\mathrm{MCP}}) & \leq & 30/180 \cdot \pi
\end{aligned}
\end{equation*}
Remind, that the overall size of the observable measurements $ \tilde{\mathrm{M}} $ is $ (3 \cdot N) \times 1 $ (with $ N $ being the number of sensors, taken into account) and the size of the system state $ \mathrm{X} $ is $ (3 \cdot K) \times 1 $ (with $ K $ being the number of finger poses to describe). In order to gather a fully determined system, the number of used sensors has to be at least as high as the number of magnets. This means, trying to estimate the state of four fingers with only one sensor would lead to ambiguous results. Furthermore, the objective function $ f(\mathrm{X}_K) $ can be described by the dipole or the cylindrical magnetic model. The problem can be solved by applying the anatomic constraints as bounds or not. It is implemented with methods, provided by the \emph{SciPy} package. It provides the \emph{minimize} function, which is especially for solving scalar minimization problems. It can be invoked with different algorithms and their corresponding additional options.

The following explanations should give a short overview on the principle of the utilized minimization methods and why they were chosen. For further reading on numerical optimization methods, please have a look at the work of Nocedal et al. \cite{nocedal2006numerical} (on which the following paragraphs are based).\\
For solving the problem without taking the anatomic bounds into account, the \ac{BFGS} algorithm is used. It is an approximation of Newton's method, for finding a solution. Newton's method describes derivative based approaches, to find local minima around a certain initial guess $ \mathrm{X}_{0} $. To find values for the variable $ X_{K} $, which minimizes the outcome of the objective function $ f(\mathrm{X}_K) $, different search methods exist. The \ac{BFGS} algorithm uses a line search approach to find the local minimum along a line, which is determined by the Jacobian $ \nabla f $ and Hessian $ \nabla^{2} f $. The \ac{BFGS} approximates the Hessian  $ \nabla^{2} f $ and is therefore called a quasi-Newton method. The derivative $ \nabla f $ is updated at every iteration. To calculate it, the objective function is evaluated with a state having slightly different values, than the provided initial guess $ \mathrm{X}_{0} $. An iteration step consists of finding a value $ x_{k+1} $, which minimizes $ f $. This is done till the gradient norm $ || \nabla f|| < \epsilon$, with $ \epsilon $ representing the convergence tolerance. In other words, a solution is found, if the change in the value of $ ||\nabla f|| $ is smaller than $ \epsilon $. As a characteristic of the \ac{BFGS} method, only the first derivative needs to be approximated. The rate of convergence for the method is stated to be linear. The overall termination tolerance, defining the magnitude of $ f(\mathrm{X}_K) $ is denoted to be $ 1.0\text{e}-07 $. Shrinking this value, would lead to more exact results, but would also induce more iteration steps and therefore a higher computation time.\\
For solving the problem by taking the anatomic conditions into account, \emph{SciPy} provides a method called \ac{SLSQP}. The constraints can be passed in as a pair of $ (min,max) $ for each variable, and reflect hard bounds. The underlying principle is based on least-squares methods. Therefore the system has to be overdetermined or at least fully determined. It tries to fit the observed data (i.e. the measurements) to a given model, by adjusting the model parameters. This is actually often used for data-fitting. While a system state is desired and the model comes with no additional parameters, the method is used in a slightly different way. In contrast to the classic approach, the model is fitted to the measurement data. The parameters in this case are the values of the system state $ \mathrm{X}_K $. In the least squares sense, the sum of the errors between the model at state $ \mathrm{X} $ and the measurements is squared and minimized. Exactly this is expressed by the objective function $ f(\mathrm{X}_K) $. Again, a starting point $ \mathrm{X}_{0} $ has to be provided. For identifying the direction of $ x $ in each iteration step, Powells method \cite{powell1964efficient} is used. This derivative free approach identifies independent convergence vectors for each variable. It can be interpreted as the approximation of $ \nabla f $. At each iteration step, those search directions are redefined and therefore the new system state can be expressed by a combination of them in turn. In order to bring in the constraints, $ f $ is modified to represent those restrictions as a non-negative least squares problem. As the name suggests, the restriction to the system state is the following $ \mathrm{X} \geq 0$. Those reformulations are done by the \emph{SciPy} method, therefore no further adjustments to the model or the bounds have to be made by the user. In the end the recursion gets performed, till the termination tolerance for $ f(\mathrm{X}_K) $ is fulfilled. This value is again chosen to be $ 1.0\text{e}-07 $.\\
It should be mentioned, that for the implemented estimation routine, the initial guess $ \mathrm{X}_{0} $ is always chosen to be the state, estimated one step ahead. 

\FloatBarrier
\subsubsection{Classifying the Methods with Simulated Data} \label{subsubsec:simEval}

In order to get an impression on the expectable results of the minimization method, it is tested with a simulated dataset. A self chosen predefined set of states is determined, which should represent the motion of the fingers. This sequence of joint angles is simulated using the cylindrical model, to obtain the value of the expectable magnetic flux density, measurable by a specific sensor for the corresponding system state. The cylindrical model is used, since it represents the de facto magnetic flux densities, excited by the bar magnet. Those values for the expectable magnetic flux density are then passed to the minimization routine, to estimate the system states. The result of the minimization should of course reflect the predefined motion sequence. Therefore it can directly be compared to the known state values, to identify the quality of the solver and its behaviour.\\
As stated previously, there are several parameters for formalizing the estimation problem and to tune the solver:
\begin{itemize}
\item Expressing the minimization as an unconstrained (by using the \ac{BFGS} algorithm) or constrained (by using the \ac{SLSQP} algorithm) problem
\item Considering the influence of the movement of adduction-abduction or not.
\item Formalizing the objective function using the cylindrical or the dipole model.
\item The behaviour regarding different determinedness of the system, which means estimating the states of one or multiple fingers by taking one or multiple sensors into account.
\end{itemize}
The results will be compared by calculating the mean and standard deviation of the error-norm to the perfect system state for each finger. Moreover, the calculation times of the different methods allow a conclusion to the number of needed iterations to find a solution.

As a first step, the different optimization parameters are evaluated for the movement of a single finger. Therefore the size of the system state  is $ \mathrm{X}_{1} = 3 $ for taking $ \phi_{\mathrm{MCP}} $ into account and $ \mathrm{X}^\prime_{1} = 2 $ for neglecting this state variable. The size of the simulated measurement vector is dependent on the number of sensors, taken into account. The index finger is chosen for evaluating the different parameters, but the results are expected not to change, by choosing a different one. The used gesture sequence is displayed for the three states of the index finger in \ref{fig:indexStates}.\\
The angular change, and therefore the stepwidth between two states is determined by combining the observations for the angular velocity from Ingram et al. \cite{ingram2008statistics} and the data rate of the sensor system. An acquisition frequency of \SI{20}{\Hz} in combination with a mean angular velocity of \SI[per-mode=symbol]{10}{\degree \per \second} leads to an observable maximum change of \SI[per-mode=symbol]{0.5}{\degree \per \second} (= \SI[per-mode=symbol]{0.0085}{\radian \per \second}). Therefore, the whole set for the utilized motion is divided into 1419 datapoints. For obtaining this number of simulated measurements by the sensor units, would result in a total theoretical duration of \SI{70.95}{\second}. The state values are plotted against time. The motion is constructed to represent simple and complex movements of the finger, including flexion-extension, as well as adduction-abduction. The motion sequence includes joint movements, which happen as unique motions at a time. For example between \SI{0}{\second} and \SI{20}{\second} only the \ac{MCP} joint moves. Some, which arise together, like between \SI{40}{\second} and \SI{60}{\second}, where all three joints are performing flexion-extension. Also only small movements are simulated. Between \SI{38}{\second} and \SI{42}{\second}, $ \theta_{\mathrm{PIP}} \; \text{and} \; \theta_{\mathrm{DIP}} $ change only about \SI{0.26}{\radian}. The movement of adduction-abduction is applied during a short sequence, since the range of movement is small and also occurs more rarely, compared to flexion-extension.\\
\begin{figure}[!htb]
\centering
\includegraphics{pictures/plots/indexStates.png}
\caption[Introduced movement pattern for index finger estimation]
{The introduced motion pattern for the estimation of the state vector for the index finger. For a better readability, the four states are divided into individual figures. The movements are chosen to test whether the estimation is capable of changes, happening to a single state or a combination of them.}
\label{fig:indexStates}
% python script: 160224_plotSequence.py
\end{figure}
%\todo{Also explain WHY the results are like they are!
%	\begin{itemize}
%	\item Overdetermindness: Because the minimizer has more equations, to solve the problem and is therefore directed in the right direction already by the measurements/system values
%	\item Cylindrical: Because you predict the field with it (I think I got that...)
%	\item Constrained/Unconstrained: I think I got that, otherwise, obvious...
%	\item ad-ab: mainly because you simulate the movement of ad-ab at a small time span and have the B-field of it in your states. Without that, the results would be as good as with ad-ab. This proves, that $ \phi_{MCP} $ can be estimated properly! And since it is more natural, ... (think I got it at some points...)
%	\end{itemize}}
The obtained error means and standard deviations for each parameter combination are presented in \ref{tab:oneFing} in radians. The numbers in the very first column indicate the combination of fingers and sensors. The first number represents the estimated finger state vectors $ K $, which is for this comparison always one, since only the states of the magnet at the index finger are estimated. The second number represents the amount of simulated measurements $ N $. By using only one simulated sensor reading, the unit beneath the index finger is meant. By taking two into account, the index and middle sensors are pointed. And four means that all four simulated units are regarded. The abbreviations in the second column reflect whether the movement of $ \phi_{\mathrm{MCP}} $ is regarded or not. ``no ad-ab'' stands for no adduction-abduction movement and ``ad-ab'' for the opposite. 
\begin{table}[!htb]
\centering
\begin{tabular}{l l c c c c}
\toprule
 & &          				\multicolumn{2}{c}{Unconstrained}          &		\multicolumn{2}{c}{Constrained}\\ \cmidrule(lr){3-4}\cmidrule(lr){5-6}
 & & 								Dipole   			   & Cylindrical 	 			 & 		Dipole 			& 		Cylindrical \\ \midrule[2pt]
\multirow{2}{*}{11} & no ad-ab    & $ 0.194 \pm 0.002 $ & $ 0.074 \pm 0.001 $ & $ 0.367 \pm 0.015 $ & $ 0.035 \pm 0.000 $ \\ 
					& ad-ab		 & $ 0.252 \pm 0.003 $ & $ 0.257 \pm 0.013 $ & $ 0.570 \pm 0.020 $ & $ 0.570 \pm 0.020 $ \\ \midrule
\multirow{2}{*}{12} & no ad-ab    & $ 0.124 \pm 0.001 $ & $ 0.094 \pm 0.001 $ & $ 0.052 \pm 0.000 $ & $ 0.035 \pm 0.000 $ \\ 
					& ad-ab		 & $ 0.071 \pm 0.000 $ & $ 0.000 \pm 0.000 $ & $ 0.058 \pm 0.000 $ & $ 0.000 \pm 0.000 $\\ \midrule
\multirow{2}{*}{14} & no ad-ab    & $ 0.112 \pm 0.001 $ & $ 0.098 \pm 0.001 $ & $ 0.040 \pm 0.000 $ & $ 0.033 \pm 0.000 $ \\ 
					& ad-ab		 & $ 0.042 \pm 0.000 $ & $ 0.000 \pm 0.000 $ & $ 0.038 \pm 0.000 $ & $ 0.000 \pm 0.000 $\\										
\bottomrule
\end{tabular}
\caption[Quality of the minimization method for estimating one finger]
{The error mean and standard deviation for each tuning parameter of the minimization procedure are listed. The values are given in radians. ``no ad-ab'' means, that the used objective function did not comprise the state $ \phi_{\mathrm{MCP}} $, vice versa for ``ad-ab''. The system configuration is coded with the numbers. The first one stands for the size of the estimated finger state vectors $ K $, the second for the number of simulated sensor units $ N $ taken into account. The best promising results are represented by the constrained methods, which take $ \phi_{\mathrm{MCP}} $ into account. It is also observable, that the system has to be overdetermined in order to lead to a good estimation of the system states. The minimization is performed on an introduced movement pattern for the index finger, whose values for the excited magnetic flux densities are simulated using the cylindrical bar magnet model. So only one finger state vector is estimated.}
\label{tab:oneFing}
\end{table}


One thing, that can be observed directly, is that for the case ``11'' which still represents a full determined system, the results show a very high deviation from the perfect values, regardless how the model is adjusted. The mean over all errors is \SI{0.289}{\radian}. The best observable values for taking only one sensor unit into account can be obtained by the method using the constrained cylindrical model and neglecting adduction-abduction. By regarding, that the inserted magnetic values were predicted by this model and that the overall system state is simplified, this seems reasonable. Furthermore, the constraints restrict the algorithm not to drift too far away. \ref{fig:11cylNa1} shows the results for this best guess and the deviation from the perfect values over time. \\
By deploying only one set of forecasted sensor values more ($ N = 2 $), the results get much better. The mean over all error means is \SI{0.054}{\radian}. Also the standard deviation is almost constant. One could even state, that by using all four simulated sensor units, the error does not decrease very much (the mean over all errors is \SI{0.045}{\radian}). Therefore it can be stated as a first observation, that the system has to be overdetermined. The objective function is described by more equations as there are variables to find. The solver is therefore directed into the right direction already by the additional system values.\\
By comparing the error from the objective function using the dipole model with the one formulated with the cylindrical, a decrease can be observed. As already stated for the ``11'' case, this just seems reasonable, since the magnetic flux densities were calculated by the same. However, for real observed measurements, this has to be further evaluated.\\
Also, while considering that the field values for the estimation still comprise the movement of adduction-abduction and since the ability to estimate the system state with a reasonable accuracy, the neglecting of those values just results in worse results. The biggest difference to the perfect values occur here at the time, the lateral movement is performed. The remaining parts, where $ \phi_{\mathrm{MCP}} $ is 0 are also almost perfect. By looking at the difference between the results of the constrained and unconstrained methods a slight decrease of the error if the constraints are obeyed can be observed. The algorithm shows better convergence by the deployed constraints. In the end almost fault free results can be observed by the cylindrical model, which takes the movement of adduction-abduction into account. Here it does not count too much, whether the minimizer is constrained or not. %\todo{concluding statement? what are bad results? which dimension of errors is acceptable?}\\
\begin{figure}[!htb]
\centering
\includegraphics{pictures/plots/difOne2.png}
\caption[Estimated states vs. perfect states for using one magnet, one sensor.]
{The estimated states and their deviation from the perfect values over time is displayed. The used objective function is described by the equation of the cylindrical model and does not comprise the state $ \phi_{\mathrm{MCP}} $. Therefore the deviation around \SI{40}{\second} is acceptable. For the constrained minimization one sensor reading is used to estimate the pose of the index finger. This model represents the best expectable results for estimating one state vector with one magnet, with $ \mu = 0.035 \pm 0.000 $. At the end, the system tends to show bigger deviations from the perfect values.}
\label{fig:11cylNa1}
% script: 160223_compareResults.py
\end{figure}
\FloatBarrier

In \ref{tab:timeOneFing} the mean time, needed for one estimation cycle is listed in seconds. The computation time can be seen as a measure of how many iteration cycles are needed by the solver. It can be observed, that the time increases with the determinedness of the system. This is only reasonable, since the algorithm has more equations to take into account and to evaluate. Also the constrained methods show a faster timing behaviour, than the unconstrained. As a reason the restricted search space of the solver could be mentioned. To reach a reasonable result, the solver needs less iterations. The reduced system state by neglecting the adduction-abduction movement is also faster than the model, comprising this state, what is because of the reduced system size. The objective function, formulated with the dipole model shows also a faster evaluation time, compared to the one using the cylindrical. Since the cylindrical model represents a numerical approximation, which has to be evaluated at each iteration, the time consumption for evaluation is higher.\\
By comparing the quality of the solver with its timing behaviour, it can be stated that an increase in precision comes with higher computation times. For this example, using the perfect simulated data for the magnetic field, the estimation is not always fast enough, to match the observed sensor system frequency of \SI{20}{\Hz}. However, it is evaluated, that the estimation results won't degrade drastically, if one or two measurements would be skipped, due to the computation time. The actually estimated system state is only used as initial starting guess for the next estimation. It is observed that the solver is capable to intercept changes of a minimum of $ \pm 0.2 \si{\radian} $ between two measurements. So the initial starting point has a less important role for the solvability. For the assumed maximum angular velocity of \SI[per-mode=symbol]{0.175}{\radian \per \second} this change would reflect to a missing of one data set. What is more critical is the capability of estimating the state almost at real time. For the used simulated magnetic field values the best configuration for the minimizer to estimate the system state with an adequate frequency would be given by using the cylindrical magnetic model with adduction-abduction and taking the anatomic constraints into account. This would result in an estimation frequency of around \SI{7}{\Hz}, since the time needed to solve the problem is about \SI{0.148}{\second}. Compared to other hand tracking systems, this value is not good. However, for getting a rough feedback on the actual finger state, this value should be sufficient.
\begin{table}[!htb]
\centering
\begin{tabular}{l l c c c c}
\toprule
 & &         			\multicolumn{2}{c}{Unconstrained}		 & 	\multicolumn{2}{c}{Constrained}\\ \cmidrule(lr){3-4} \cmidrule(lr){5-6}
 & & 								Dipole & Cylindrical & Dipole & Cylindrical \\ \midrule[2pt]
\multirow{2}{*}{11} & no ad-ab    & 0.037 & 0.077 & 0.008 & 0.017 \\ 
					& ad-ab		 & 0.089  & 0.119 & 0.029 & 0.037 \\ \midrule
\multirow{2}{*}{12} & no ad-ab    & 0.063 & 0.139 & 0.014 & 0.031 \\ 
					& ad-ab		 & 0.114 & 0.214 & 0.031 & 0.074  \\ \midrule
\multirow{2}{*}{14} & no ad-ab    & 0.110 &  0.251 & 0.025 & 0.059 \\ 
					& ad-ab		 & 0.216 & 0.409 & 0.056 & 0.148 \\										
\bottomrule
\end{tabular}
\caption[Time for one estimation step of one finger state vector]
{The table allows a comparison of the mean evaluation time (in seconds), needed for the presented minimization methods for estimating one finger state vector. The time is displayed in seconds. Note the influence of using a constrained or unconstrained method. Also a reduction in evaluation time can be observed while shrinking the size of the measurement vector $ \tilde{\mathrm{M}} $. The fastest method shows an evaluation time of \SI{0.029}{\second} for estimating a single state vector. However, the quality of the results is not satisfying. For more exact estimated values, the time lies around 0.074 to \SI{0.148}{\second}. This results in low estimation frequencies, however an almost real-time-like representation should be possible.}
\label{tab:timeOneFing}
\end{table}

\FloatBarrier
For estimating the movement of multiple fingers, an adequate motion pattern is deployed. The simulated sequence consists only of 100 datapoints, reflecting a measurement time of only \SI{10}{\second}. This short time period is chosen, since first tests showed a high time consumption of the estimation stage. The utilized motion is visualized for each finger and each state in \ref{fig:multiFing}. As visualized in the figure, the fingers are moving individually, to test whether the estimation is capable of that.\\
\begin{figure}[!htb]
\centering
\includegraphics{pictures/plots/multiStates.png}
\caption[Introduced movement pattern for four finger estimation]
{The introduced motion pattern for the estimation of the state vectors for multiple fingers. In each column the states for one finger are displayed. The motion is deployed to represent individual movements of the finger, to check whether they cause a reasonable influence on the magnetic field to be estimated. Therefore each finger state itself is slightly different to the other.}
\label{fig:multiFing}
% python script: 160224_plotSequenceMulti.py
\end{figure}
For getting an insight, how good the states for multiple magnets can be estimated, several sensor-magnet configurations are simulated. The evaluation is done for two fingers (the index and middle) and all four. As learned from the previous results, four sensors are used for the estimation of two fingers, to ensure overdeterminedeness. However, for estimating all four finger state vectors, the introduced system can only satisfy determinedness. For reasons of completeness, four additional sensors were introduced to the simulation, placed behind the four existing ones, to achieve a value of $ N = 8 $. As for the estimation of one finger, the values are simulated using the cylindrical model. The results are listed in \ref{tab:multFing}. The corresponding parameters are coded in the same manner as beforehand.\\
\begin{table}[!htb]
\centering
\begin{tabular}{l l c c c c}
\toprule
 & &          				\multicolumn{2}{c}{Unconstrained}          &		\multicolumn{2}{c}{Constrained}\\ \cmidrule(lr){3-4}\cmidrule(lr){5-6}
 & & 								Dipole   			   & Cylindrical 	 			 & 		Dipole 			& 		Cylindrical \\ \midrule[2pt]
\multirow{2}{*}{24} & no ad-ab    & $ 0.119 \pm 0.000 $ & $ 0.081 \pm 0.000 $ & $ 0.051 \pm 0.000 $ & $ 0.039 \pm 0.000 $ \\ 
					& ad-ab		 & $ 0.114 \pm 0.000 $ & $ 0.000 \pm 0.000 $ & $ 0.085 \pm 0.000 $ & $ 0.005 \pm 0.000 $ \\ \midrule
\multirow{2}{*}{44} & no ad-ab    & $ 0.941 \pm 0.006 $ & $ 0.484 \pm 0.001 $ & $ 0.314 \pm 0.000 $ & $ 0.216 \pm 0.000 $ \\
					& ad-ab		 & $ 1.361 \pm 0.022 $ & $ 0.024 \pm 0.000 $ & $ 0.223 \pm 0.000 $ & $ 0.140 \pm 0.000 $ \\ \midrule
\multirow{2}{*}{48} & no ad-ab    & $ 0.543 \pm 0.001 $ & $ 0.509 \pm 0.001 $ & $ 0.236 \pm 0.000 $ & $ 0.183 \pm 0.000 $ \\ 
					& ad-ab		 & $ 0.494 \pm 0.000 $ & $ 0.005 \pm 0.000 $ & $ 0.385 \pm 0.000 $ & $ 0.098 \pm 0.000 $\\										
\bottomrule
\end{tabular}
\caption[Quality of the different minimization methods for estimating multiple fingers]
{The error mean and standard deviation for the different system configurations and minimization methods in \si{\radian} are listed. The values are given in radians. To achieve overall acceptable results, the overdeterminedness is again critical. The deployed system, consisting of four sensor units is therefore barely suited to estimate all four finger states which can be observed by an minimum error of \SI{0.024}{\radian}. As an extra, four additional sensor units were simulated. The results for this method show that it is in the end possible, to reconstruct four finger state vectors, as long as the system is overdetermined.}
\label{tab:multFing}
\end{table}
By looking at the results for the estimation of the state vectors for multiple fingers, a similar behaviour as mentioned for the fully determined case beforehand can be obtained. However, one interesting change can be observed. The unconstrained minimization method, described by the cylindrical model and taking $ \phi_{\mathrm{MCP}} $ into account shows here a better behaviour, than the constrained one. This is observable for each configuration of $ N $ and $ K $. One reason could be, that the \ac{BFGS} algorithm gives for those cases a better approximation for the search direction, than the constrained \ac{SLSQP} method. With the increasing number of system states, also the complexity increases. The constrained solver reaches its bounds, by using not good enough search directions. The unconstrained method however has more freedom, to look in each direction. For the estimation of two finger states, the unconstrained method using the cylindrical model and taking $ \phi_{\mathrm{MCP}} $ into account leads to the best results. For the estimation of all four fingers however, the minimization is not capable to reflect the perfect system states anymore. The overall smallest error for the estimation of four fingers with four sensors is \SI{0.024}{\radian}. The information, provided by the simulated measurement units is not sufficient, to describe the variables. For the actually built system, comprising four sensors, an estimation of all four fingers is expected not lead to reasonable results. For getting an impression on the estimated states, compared to the perfect ones, those obtained values are plotted in \ref{fig:difMult}. \\
However, by introducing four additional sensors (case ``48''), the results are getting better. A mean error of \SI{0.005}{\radian} is observed by the unconstrained method, using the cylindrical model with adduction-abduction. However, as stated beforehand, the introduction of such a high number of magnets would break the goal of constructing a mobile and unobtrusive system. \\
By looking at the required estimation time of the several methods, a tremendous increase can be observed (see \ref{tab:timeMultFing}). This is not only due to more iterations, but mainly induced by the higher system states $ N $ and $ K $. To still observe reasonable results of the estimated states, more than \SI{1}{\second} is needed. This can be observed by almost all minimization configurations. This means a proper real time evaluation of the finger pose estimation is not possible anymore. By increasing the number of sensors $ N $ to 8, about \SI{17}{\second} would be needed to achieve reasonable results, which is obviously far away from real time behaviour or acceptance for post processing. \\
\begin{figure}[!htb]
\centering
\includegraphics{pictures/plots/difMult.png}
\caption[Estimated states of four sensors and four magnets]
{The displayed results are for the objective function which comprises $ \phi_{\mathrm{MCP}} $ and is formulated with the cylindrical model equation. The unconstrained minimization estimates on the base of four simulated sensor readings the state vectors of four fingers. The estimated and perfect states are plotted for each finger and their observed deviation over time. The mean difference over all for fingers is $ \mu = 0.024 \pm 0.000 $. The highest deviation can be recognized for $ \theta_{\mathrm{MCP}} $ of the middle finger. The states of the other fingers can be estimated pretty well.}
\label{fig:difMult}
% script: 160224_compareResMulti.py
\end{figure}
\begin{table}[!htb]
\centering
\begin{tabular}{l l c c c c}
\toprule
 & &         			\multicolumn{2}{c}{Unconstrained}		 & 	\multicolumn{2}{c}{Constrained}\\ \cmidrule(lr){3-4} \cmidrule(lr){5-6}
 & & 								Dipole & Cylindrical & Dipole & Cylindrical \\ \midrule[2pt]
\multirow{2}{*}{24} & no ad-ab    & 0.920 & 1.632 & 0.291 & 0.382 \\ 
					& ad-ab		 & 2.129  & 3.346 & 0.602 & 1.275 \\ \midrule
\multirow{2}{*}{44} & no ad-ab   & 3.365 & 5.012 & 0.629 & 0.947 \\ 
					& ad-ab		  & 8.322  & 8.419 & 1.696 & 2.684 \\ \midrule
\multirow{2}{*}{48} & no ad-ab    & 7.130 &  9.670 & 1.137 & 1.988 \\ 
					& ad-ab		 & 14.346 & 17.558 & 3.945 & 4.677 \\										
\bottomrule
\end{tabular}
\caption[Time for one estimation step of multiple finger state vectors]
{The mean evaluation time in seconds for estimating multiple finger state vectors is listed above. It is observable, that the estimation of four fingers is far away from real time behaviour. This, in combination with the observations regarding the quality of the estimation, no good results are expected for real measurements. Only the estimation of the states for two fingers show adequate timing behaviour.}
\label{tab:timeMultFing}
\end{table}
\FloatBarrier
The presented results visualize the behaviour and influence of different system configurations $ N $ and $ K $ for different ways of describing the minimization problem. Note that the estimations are based on perfect, simulated magnetic field values. The following concluding statements can be derived:
\begin{itemize}
\item To get a reasonable accuracy for the estimated states, the system has to be overdetermined, i.e. $ N > K $.
\item The number of function iterations (and therefore the estimation time) increases significantly with the size $ K $ of the system state.
\item An estimation of four fingers with the designed system, consisting of four sensors is expected to be barely possible in an adequate quality or real time behaviour.
\item The state $ \phi_{\mathrm{MCP}} $ for adduction-abduction introduces higher estimation times, but can be estimated and should be used, to better reflect the human hand motion.
\end{itemize}
Since the results are based on perfect simulated magnetic flux densities from the cylindrical model, the estimation procedures comprising this model lead also to better results. It is evaluated, that the cylindrical method, including adduction-abduction and anatomic constraints leads to the overall best results for the estimation of one finger. However, when porting the observations to real measurements on a human hand, one has to note that several additional distortion factors are added to the system, like the inexact position information of the finger and sensor dimensions or the surrounding magnetic field. Therefore in the ongoing estimation of real datasets, the cylindrical and the dipole method (both including the state $ \phi_{\mathrm{MCP}} $ and constraints), are both used for the state estimation.

\FloatBarrier
\subsection{Results for Recorded Datasets} \label{subsec:resMeas}

\subsubsection{Recording Procedure}\label{subsubsec:recSetup}

For the evaluation of the system at a real use case on the hand, the following setup is established. The proband wears the developed sensor unit and a number of magnets on the fingertips. The obtained magnetic field values are received and saved by a Laptop, to perform the state estimation phase afterwards. In this way specific parameters of the objective function or the system, like the number of sensor readings taken into account, can be adjusted later on and the results can be compared. The quality of the system is further compared to the Leap Motion \cite{leap}. Therefore, the sensor data is recorded with the hand held above this device. For a rough qualitative judgement, a video of the performed movements is recorded. A poster with a circle and angular ticks is installed behind the motion area. A photo of the whole setup is shown in \ref{fig:setup}. Each recorded dataset consists of the states, obtained by the vision based Leap Motion system and the sensor readings from the measurement units. For the fitting of the sensor values to the hand measured joint and finger positions, each set comprises the introduced calibration gesture of bending the fingers around the \ac{MCP} joints about \SI{90}{\degree}. Since the dynamic cancellation of the earth magnetic field is not possible with the method presented in \ref{subsec:earthEli}, the hand was tried to be held calm and at a constant position throughout the whole recording session. So in the end, by this setup a comparison between the presented magnetic approach and the existing vision based Leap Motion system is possible.
\begin{figure}[!htb]
\centering
\begin{tikzpicture}
\centering
\node[anchor=south west,inner sep=0] (image) at (0,0,0) 
	{\includegraphics[width=0.8\textwidth]{pictures/setup22.jpg}};
\begin{scope}[x={(image.south east)},y={(image.north west)}]
    \draw[solid,red,<-,line width=1.5] (0.85,0.85) -- +(0,0.16)node[anchor=south] {Box with angle poster};
    \draw[solid,red,<-,line width=1.5] (0.7,0.73) -- +(0,0.1)node[anchor=south] {Leap Motion};
    \draw[solid,red,<-,line width=1.5] (0.23,0.95) -- +(0.,0.08)node[anchor=south] {Camera};
    \draw[solid,red,<-,line width=1.5] (0.4,0.1) -- +(0.1,0.)node[anchor=west] {PC};
    \draw[solid,red,<-,line width=1.5] (0.7,0.5) -- +(-0.1,-0.12)node[anchor=north] {Magnetic system};
\end{scope}
\end{tikzpicture}
%\includegraphics[width=0.8\textwidth]{pictures/setup22.jpg}
\caption[Measurement setup]
{The measurement setup with all relevant parts.}
\label{fig:setup}
\end{figure}


\FloatBarrier
\subsubsection{Evaluation, Discussion and Comparison to Leap Motion and Video Data}

The following paragraph presents and discusses the difference of the estimated states by the magnetic system with the data, returned by the Leap Motion. Both systems show different acquisition frequencies. While the magnetic system works at the evaluated \SI{20}{\Hz}, the Leap Motion shows a framerate of \SI{110}{\Hz}. For a direct comparison between the two systems, the data from the Leap is downsampled. For this, the magnetic and the Leap system save a timestamp, which represents the uptime of the system when the actual reading is observed. To adapt the Leap data to the magnetic system, only the data with the timestamp, the closest to the one of the magnetic system is chosen. This method was evaluated to do the resampling in a representative manner, without loosing too much information or degrading the data unintentional. 
The presentation and discussion is structured similar to \ref{subsubsec:simEval}. So at first the state vector of only one finger (the index) is estimated. The observations, made in the previous chapters are deployed for the formulation of the ongoing estimation problem. Therefore the finger state vector includes $ \phi_{\mathrm{MCP}} $ and the results are based on the minimization algorithm \ac{SLSQP}, which takes the anatomic constraints into account. 
Therefore the results of six different combinations of formalizing the optimization problem can be compared and evaluated. Those are: Describing the objective function with the dipole or the cylindrical model and using the measurements of one, two or all four sensor units. The comparison to the Leap will show, which influence the determinedness of the system has on real measurements and whether the states could be better estimated by describing the objective function with the cylindrical bar magnet or the magnetic dipole model. Since the previous results on simulated data showed that only the estimation of a single finger state vector leads to reasonable outcomes, the emphasize of the evaluation is put onto the calculated finger states of the index finger.

15 datasets were recorded, each consisting of the state values, returned by the Leap system and the corresponding measurements of all four sensor units, excited by the magnet on the index finger tip. As already described, each set of obtained magnetic flux densities includes the initialization gesture, to compensate the hand measured system dimensions and to eliminate the surrounding magnetic field. Therefore, as an introductory step this movement has to be extracted to determine the scaling factors for each sensor unit, which have to be applied to the respective measurements. Based on those values, the states for the index finger were estimated. The difference vector to the states, returned by the Leap Motion system is calculated and normed for each estimated state, to get an overall measure for the deviation for each estimated set. Since the sets differ not only in the duration from each other but also by the speed and complexity of the performed movements, they have to be examined individually. Also if all sets would comprise the same length and the same predefined movements, a cumulative mean and standard deviation would not serve good and representative values for those. This is induced, since the system is conditioned by many external influences, like the often mentioned hand size parameters, the continuity of the hand's height and orientation and the speed and movement range of the motion. However, to proper evaluate the recorded sets and to compare them to each other, the method, showing the smallest error mean for one recorded set is determined. The results are listed in \ref{tab:estSet}. For each set the best parameters of the optimization method are coded by \mbox{\emph{cyl/dip\_ $ K N $}}, with
\begin{itemize}
\item \emph{cyl} meaning that the cylindrical model and 
\item \emph{dip} saying that the dipole model is used to formulate the objective function
\item $ K $, the number of finger state vectors to estimate and
\item $ N $, the number of sensors, taken into account for the estimation.
\end{itemize}
So for example ``cyl\_12'' means, that the objective function is formulated with the cylindrical model for estimating one finger state vector ($ K = 1 $), by using the measurements from two sensor units ($ N = 2 $). In the case of $ N = 1 $, the sensor beneath the index finger is used, for $ N = 2 $, the one under the middle finger is added and $ N = 4 $ means that the measured values of all four sensors are taken into account.
\begin{table}[!htb]
\centering
\begin{tabular}{l c c}
\toprule
 & Method & $ \mu [\si{\radian}] \pm \sigma^{2} $ \\ \midrule 
\textbf{Set 1}  & cyl\_12 & $ 0.581 \pm 0.020 $ \\ 
\textbf{Set 2}  & cyl\_12 & $ 0.587 \pm 0.012 $ \\ 
\textbf{Set 3}  & dip\_12 & $ 0.646 \pm 0.010 $ \\ 
\textbf{Set 4}  & cyl\_12 & $ 0.467 \pm 0.017 $ \\ 
\textbf{Set 5}  & cyl\_14 & $ 0.668 \pm 0.027 $ \\ 
\textbf{Set 6}  & cyl\_12 & $ 0.495 \pm 0.011 $ \\ 
\textbf{Set 7}  & cyl\_14 & $ 0.567 \pm 0.026 $ \\ 
\textbf{Set 8}  & cyl\_14 & $ 0.670 \pm 0.052 $ \\ 
\textbf{Set 9}  & dip\_14 & $ 0.606 \pm 0.024 $ \\ 
\textbf{Set 10} & cyl\_14 & $ 0.581 \pm 0.010 $ \\ 
\textbf{Set 11} & cyl\_14 & $ 0.603 \pm 0.004 $ \\ 
\textbf{Set 12} & dip\_14 & $ 0.676 \pm 0.022 $ \\ 
\textbf{Set 13} & cyl\_14 & $ 0.680 \pm 0.018 $ \\ 
\textbf{Set 14} & cyl\_14 & $ 0.525 \pm 0.010 $ \\ 
\textbf{Set 15} & cyl\_14 & $ 0.672 \pm 0.012 $ \\ \bottomrule
\end{tabular}
\FloatBarrier


\caption[Parameters for the estimation results, showing the smallest difference to the Leap Motion]
{The table lists the methods, whose estimated states show the smallest difference to the one obtained by the Leap Motion system. The provided values represent the lowest mean and standard deviation in \si{\radian} for each set individually. The states from the Leap system serve here as the truth values. The results for Set 3, estimated with the dipole model by using two sensor units shows the overall smallest difference to Leap system. It can be noted that the average error of those best estimated states is relative high. One has to note, that at each set different motion patterns were performed. Also the duration of each set varies. Therefore a direct comparison between them would not lead to a representative statement.}
\label{tab:estSet}
\end{table}
The time needed for the estimation of a measurement set is also reported. Here, almost no differences to the results, obtained in \ref{subsubsec:simEval} are observed. The timing behaviour of the slowest set was evaluated to be \SI{0.092}{\second} and is observed by a method using four sensor readings. This value is in fact higher, than the system frequency, but the results are expected not to degrade with a loss of measurement sets. Since by the recognized maximum evaluation time at most one data set gets neglected. Regarding the realtime capability, the respective worst estimation frequency would be \SI{10}{\Hz}. Since those results are not very surprising and were already discussed in \ref{subsubsec:simEval}, the time values are not further explained here.

From \ref{tab:estSet}, the observations regarding the formulation of the optimization method from \ref{subsubsec:simEval} are confirmed. The system has to be at least overdetermined, since no good results are reached by the method using only one sensor unit for the estimation. Also taking as much measurements into account as available leads more often to better results, than taking only two sensors into account. As an explanation one can name the same reason as before, the minimizer has more information about the actual system state and can therefore find a more exact solution for the problem. However, 5 out of 15 sets show better results with $ N = 2 $, than with $ N = 4 $. Also the two sets with the lowest difference to the Leap states use only two sensor values. This can be putted down to faulty measurements, induced by unstable positions and alignments of the hand during the data acquisition. By using faulty measurements it is harder to find a solution. Introducing a higher number of those leads to a worsening of the results. Therefore sometimes it is better to take less measurements into account, if one knows that they are bad. By taking more sensor units into account, one puts a higher trust into them. Regarding less, one relies more on the capabilities of the minimization method. In the end it's a trade off between both.\\
Moreover it can be stated, that the objective function, described by the cylindrical bar magnet model leads to better results as the dipole model. So it is  verified, that this model describes the magnetic field, induced by a cylindrical bar magnet, better, than the approximation with the dipole model. However, 3 out of 15 datasets return better results for the dipole model. But by looking a bit closer to the errors, returned by the other minimization methods for these data sets, one recognizes, that the difference to the error, observed by a cylindrical method is only slightly smaller. For example for Set 3, the results for the \emph{cyl\_12} method are only worse by \SI{0.008}{\radian}. \\
So in the end, the smallest deviation to the observed states from the Leap motion can be provided most often from the highest overdetermineded minimization method, formulated with the cylindrical model equation, \emph{cyl\_14}. In numbers: 8 out of 15 sets. However, set 4 is showing the smallest deviation over all recorded datasets and uses only two sensor units for the estimation (\emph{cyl\_12}). Set 4 shows a mean and standard deviation of $ 0.467 \si{radian} \pm 0.027 $. By regarding at the general quality of the states, obtained of the magnetic estimation versus the data from the Leap system, one can note that the errors are pretty high. The mean over all sets is $ 0.602 \si{\radian} $, which corresponds to a difference of \SI{34.5}{\degree}. As mentioned beforehand this value has to be handled with care, since each dataset shows a different size and motions. That the presented magnetic system is despite that big difference capable to track the finger motions under certain conditions is further evaluated. It will be determined which motions and effects cause this high error value. For the visualization of the returned states of both systems, set 4 is plotted in \ref{fig:bestLeap}. An explanation to the magnitude and the characteristics of the differences is provided a bit later in this section. 

As next step, the results for estimating four finger state vectors are presented. The recording procedure is done in the same way as for one state vector, beside that now each finger is equipped with a magnet on its tip. The estimated finger state vectors are each compared individually to the corresponding data of the Leap system. In this way, the means and standard deviations of the differences between the two systems are determined for each finger individually. Mind, that the state estimation problem has now the following size: $ N = 4 $, $ K = 4 $. As additional parameter for the estimation phase, the problem is concerned to be constraint and to include the state $ \phi_{\mathrm{MCP}} $. Only the type of the objective function is varied. It was evaluated, that the one, described by the cylindrical model leads better results, compared to the states observed by the Leap Motion. The mean values for the difference of each finger state vector to the Leap data and the corresponding standard deviation over the sets are presented in \ref{tab:estSetFour}.
\begin{table}[!htb]
\centering
\begin{tabular}{l c c c c c}
\toprule
&  \multicolumn{5}{c}{$ \mu \si{\radian} \pm \sigma^{2} $} \\ \cmidrule{2-6}
& 			   				 Index 				 & Middle 			   & Ring 				 & Pinky 			   &  Cumulative \\ \midrule
\textbf{Set 1} &  $ 0.918 \pm 0.053 $ & $ 0.975 \pm 0.044 $ & $ 0.746 \pm 0.029 $ & $ 0.709 \pm 0.008 $ & $ 0.837 \pm 0.000 $ \\ 
\textbf{Set 2} &  $ 1.077 \pm 0.039 $ & $ 1.066 \pm 0.107 $ & $ 0.912 \pm 0.043 $ & $ 0.618 \pm 0.015 $ & $ 0.918 \pm 0.001 $ \\ \bottomrule
\end{tabular}
\caption[Difference of estimated states, compared to Leap Motion data for four finger estimation]
{The mean and standard deviation from the obtained estimation results to the Leap Motion data. Four finger state vectors are estimated. Since the obtained results show such a big difference to the Leap data and the actual performed movement, only two datasets were recorded. The high values for the mean difference and standard deviation for each finger, show that an estimation of four fingers with the deployed system is not possible.}
\label{tab:estSetFour}
\end{table}
\FloatBarrier


For the case of $ N = 4 $, only two datasets were recorded, since the results show similarities and the calculation time is quite long. For set 1 the average time per estimation step is measured to be \SI{0.837}{\second}, for Set 2 even \SI{0.918}{\second} were observed. Therefore an estimation with real time behaviour would not be possible anymore. While for the estimated results of one finger state, the difference to the Leap system is already pretty high, here a further increase is observable. The two sets comprise finger movements, which are performed simultaneously by all four fingers and alone, by only a single finger. In this way it can be checked whether the systems can distinguish between separate finger motions or not. The direct comparison of the two system states against each other shows that the magnetic estimation approach is not capable to identify individual finger movement reliably. \ref{fig:est44} tries to proof this visually. The norm of the states for the index and the middle finger, obtained by the Leap system and the magnetic estimation are plotted over time. The norm over all states for one finger is chosen, since it represents a measure for the actual predicted bending of the joints. 
\begin{figure}[!htb]
\centering
\subfloat{\includegraphics{pictures/plots/est44.png}}\\
\subfloat{\includegraphics{pictures/statePics/est44/set44s.jpg}}
\caption[Estimating the motion of four fingers]
{The norm over the states for the index and the middle finger are plotted. This should resemble a measure of the actual amount of bended angles of the finger, but does not reflect actual individual joint states. During the first \SI{17}{\second} parallel movements of all fingers are performed. Both systems show an increase for this. However, when it comes to individual movement of the fingers, the states of the magnetic system don't represent the truth anymore. At \SI{20}{\second}, the single flexion-extension of the index finger is also estimated for the middle. Furthermore between \SI{30}{\second} and \SI{35}{\second}, a movement of the pinky finger is performed, but the states are changing for the middle and index finger, which are held still. The states of the Leap motion system represent the truth much better. The pictures beneath the state figures serve as a rough visual reference.}
\label{fig:est44}
% script: 160226_leapVsEst.py
\end{figure}
In combination with the provided pictures, extracted every \SI{5}{\second} from the recorded videostream, \ref{fig:est44} serves as an example to proof, that individual finger movements can not be estimated reliably by the magnetic system. At the beginning of the short sequence, two movements which are performed by all four fingers were executed. Here the Leap and the magnetic system show both a change for the angles of the index and middle finger. Therefore both systems return in some sense the truth. The measurements of the magnetic system are fitted to the initialization gesture, which is performed around \SI{5}{\second}. However, when it comes to individual finger movements, the states for the presented fingers are estimated wrong. Around \SI{20}{\second} only the index finger is bent. This is captured by the Leap Motion correctly, since the state of the middle finger stays almost at \SI{0}{\radian}. Also the other finger states, which are unseen here for visualization reasons, are almost at \SI{0}{\radian}. The magnetic system however estimates an additional excessive change for the middle finger, which does not happen. During \SI{30}{\second} and \SI{35}{\second} a flexion-extension is performed by the pinky finger. However, the estimated states of the magnetic system during this time interval interpret a movement of the index and middle finger. The Leap system again reflects the right angles and shows only small changes for the two presented finger state vectors. This behaviour of the magnetic system can be obtained almost every time when individual finger movements occur. As a reason for the bad estimation results, one could head the following: On the one hand, the system is only fully determined, which degrades the results for the estimation, as observed in \ref{subsubsec:simEval}. On the other hand, the obtained changes of the magnetic field, induced by the movement of a single finger are only small. The parameters for the hand dimensions can only be determined up to a certain accuracy, additional erroneous contributions are introduced. The optimizer tries to fit the values to a slightly different hand model and can not reach reasonable results. The estimated angles could be improved, by acquiring more exact values for the hand dimensions and by taking the readings of more sensor units into account. However, since the deployed system consists only of four sensors, this is not further evaluated. In the end the presentation of this short example for the results of estimating the states of four magnets by using four sensor units shows, that no truthfully values can be estimated for this system configuration.
\FloatBarrier

The estimated values, obtained for the at first presented predictions of a single finger state vector showed a smaller difference to the states from the Leap Motion. On the basis of those recorded datasets and their results, a more detailed comparison to the Leap system is further presented, to identify the capabilities and drawbacks of the magnetic system. The reduced state size ($ K = 1 \rightarrow size(\mathrm{X}_{1}) = 3 \times 1 $) allows an easier examination of the results and possible sources of error. The estimated finger states of dataset 4 showed the smallest difference to the angles obtained by the Leap system. The values for the finger state vector of both systems are plotted in \ref{fig:bestLeap} over time.
\begin{figure}[!htb]
\centering
\subfloat{\includegraphics{pictures/plots/bestEst.png}}\\
\subfloat{\includegraphics{pictures/statePics/bestLeap/bestPic.jpg}}
\caption[Comparison of estimated states, which fit best to Leap data]
{Each state value of the index finger, obtained by the Leap Motion and the magnetic estimation are plotted over time. The results are for set 4, which shows the smallest deviation between both systems. The values for $ \theta_{\mathrm{MCP}} $ show the most similarities. $ \theta_{\mathrm{PIP}} $ and $ \theta_{\mathrm{DIP}} $ show common directions, however the estimated states are much higher. For the movement of adduction-abduction the Leap Motion recognizes a more restless behaviour but they also have common phases. The difference, normed over all four states is plotted at the bottom. Here the differences for $ \theta_{\mathrm{PIP}} $ and $ \phi_{\mathrm{MCP}} $ show the highest impact.}
\label{fig:bestLeap}
% script: 160226_leapVsEst.py
\end{figure} 
As a first impression and especially focusing on the values of $ \theta_{\mathrm{MCP}} $, the two systems show a quite common angle prediction. The initialization gesture, which happens at the beginning at around \SI{5}{\second}, is responded by both systems as nearly a bare movement of the \ac{MCP} joint. Only the Leap shows here contributions of adduction-abduction, which actually did not happen. This behaviour can be recognized right at the following gesture till \SI{15}{\second}, again. During this time, the beforehand mentioned movement is performed once again, just a bit slower. By regarding the magnetic estimation, some none smooth peaks for $ \theta_{\mathrm{MCP}} $ are observable over the whole set. They mainly occur, at the time, when a change of $ \theta_{\mathrm{PIP}} $ is estimated and the finger is bent to a fist. It is assumed, that at those points the solver can't find an optimal solution. It is also to note here, that for the estimated angles of the \ac{PIP} and \ac{DIP} the biggest differences between the two systems are observable. Note, that those two states are estimated as a combined one by the magnetic approach, since the anatomic condition $ \theta_{\mathrm{DIP}} = \frac{2}{3} \theta_{\mathrm{PIP}} $ is used. The direction returned by both systems is the same, which means that both show a parallel increase or decrease of the angles. However, the states from the magnetic system are much higher than the ones from the Leap Motion. Furthermore, the movement of adduction-abduction shows remarkable differences. The estimated values of $ \phi_{\mathrm{MCP}} $ by the magnetic system show a more stable behaviour than the ones returned by the Leap. It should be noted, that during the movement of flexion-extension the motion was tried to be performed with very small lateral movement. Nevertheless for this state both systems show also similarities. For example between \SI{40}{\second} and \SI{50}{\second}, the motion in negative direction and back is captured by both systems. Also the other three finger states have almost no contributions during this time interval. The pictures which are extracted each 5s from the video allow a qualitative comparison of the both systems.
\FloatBarrier


% % % drawbacks Leap
% massive ad-ab movement
For the presented dataset the estimation results were only compared to the Leap Motion, which is assumed to return the ground truth for the actual state. As already observed for set 4, those values are also not totally perfect and constant over time, which is shown for example by the very high lateral changes for $ \phi_{\mathrm{MCP}} $ in positive direction (at around \SI{5}{\second} and \SI{12}{\second}). The recorded angles indicate, that the bones move about \SI{0.8}{\radian} (=\SI{45}{\degree}) towards the middle finger, which was definitely not performed. Most of the datasets from the Leap show a high deviation for the state of adduction-abduction from the de facto values for this. For example in \ref{fig:set14} a similar behaviour during the movement to a fist is visualized. This time however the recorded contribution of $ \phi_{\mathrm{MCP}} $ at \SI{14}{\second} is negative. The observed values at around \SI{20}{\second}, where again the finger is bent to a fist, show a more or less small fluctuation and can therefore be stated as an evidence, that the false motion is not always detected. Over all the de facto performed movement did not comprise such high lateral motions. By the induced constraint and intuition from natural hand movement, it is accepted, that a maximum range of motion from \SI{-15}{\degree} to \SI{+15}{\degree} (\SI{-0.262}{\radian} to \SI{+0.262}{\radian}) is possible. During most of the time the recorded motions were performed to mainly show contributions of flexion-extension, therefore the view of the camera is also aligned to capture those movements best. Unfortunately, an exact value about the de facto size of the deviation from the real state of $ \phi_{\mathrm{MCP}} $ to the predicted cannot be stated. However, it can be stated, that the Leap shows here quite often values, which do not represent the truth. One reason for this could be the underlying method for the detection of the bone and hand directions. The Leap Motion provides normalized direction vectors for each finger and the palm. For calculating the angle of adduction-abduction from this, the angle between the direction vector of the proximal index bone and the palm, relative to the palm normal is determined.\\
\FloatBarrier
% movement of PIP induces movement of DIP
Further, concerning the behaviour of the Leap system, one can head that a kind of relationship between $ \theta_{\mathrm{DIP}} $ and $ \theta_{\mathrm{PIP}} $ exists. In almost every set, a motion of the \ac{PIP} joint introduces also a change of $ \theta_{\mathrm{DIP}} $. In \ref{fig:set14} this behaviour is presented. The observed states for $ \theta_{\mathrm{PIP}} $ and $ \theta_{\mathrm{DIP}} $ are plotted over time with the corresponding parts from the video, placed beneath. As an additional verification to the beforehand mentioned false interpretation of the adduction-abduction angle, those states are also plotted. This observation should not be stated to be false or introduce erroneous system states. The developed magnetic estimation assumes even a static relationship between those two state values. The Leap system verifies this assumption in some way. As stated in \ref{sec:anatomy} it is quite usual to assume the observed relationship. However, from the information available for the Leap, a hard programmed explanation of this behaviour is not provided.\\
\begin{figure}[!htb]
\centering
\subfloat{\includegraphics{pictures/plots/set14leap.png}}
\caption[Relationship between $ \theta_{\mathrm{PIP}} $ and $ \theta_{\mathrm{DIP}} $ observed by Leap Motion]
{The states, provided by the Leap Motion for performing two times a fist. By regarding the flexion-extension angles for \ac{PIP} and \ac{DIP}, the introduced intra finger relation between those values is verified. However, the Leap system does not show a static relation between those two angles, as it is assumed by the magnetic estimation. The states of $ \phi_{\mathrm{MCP}} $ are provided additionally, to visualize once more, that this value often returns erroneous state configurations. During the plotted motion sequence a change of this angle about the observed amount was definitely not performed. While performing the second fist, only small false motions are observed and therefore show that the returned values are not always erroneous.}
\label{fig:set14}
% script: 160229_leapDip.py
\end{figure}
% small values of PIP while performing fist
Another observation, by regarding the state vector for performing a fist from the Leap, is that the values for $ \theta_{\mathrm{DIP}} $ and $ \theta_{\mathrm{PIP}} $ are relative low and $ \theta_{\mathrm{MCP}} \simeq \pi/2 $. For example at set 4 \ref{fig:bestLeap} between \SI{18}{\second} and \SI{22}{\second}. When examining the video data qualitatively, one can recognize that the angle of $ \theta_{\mathrm{DIP}} $ and $ \theta_{\mathrm{PIP}} $ are actually higher than \SI{0.5}{\radian}. This can be explained by the fact of occlusion. While crooking the finger to a fist, especially the distal bone and the tip are hidden by the other bones. By comparing the estimated angle of the \ac{PIP} joint from the magnetic estimation, one can judge qualitatively, that those reflect the real behaviour a bit better than the Leap. The presented observations for the predicted angles from the visual system prove, that it is also not totally free of errors. So one has to keep those presented drawbacks in mind, while examining the data from the Leap Motion system.
\FloatBarrier


% % % qualitative evaluation/comparison
% ++ motions similar to init movement
% ++ slow motions of ad-ab (set4)
By checking the estimation results of the magnetic approach for all sets qualitatively with the Leap Motion and the recorded video data, one could determine some sort of gestures, which can be reconstructed relative reliable and correct. On the one hand the gesture, where the values were fitted to can be observed very stable along one dataset. This sounds only reasonable, since the obtained magnetic flux densities are adjusted right for this movement. Therefore all motions, which induce the most changes of flexion-extension on the \ac{MCP} joint fall into this category, too. Those motions can be classified as ``pre-states'' of the initialization gesture and are therefore a subset of it. This is also observable by set 4, since at \SI{10}{\second} and \SI{5}{\second} the angle of \ac{MCP} is estimated to be smaller \SI{90}{\degree}, which is also observed by the Leap and can be verified qualitatively with the pictures. Furthermore, as already observed by set 4, a slow change of $ \phi_{\mathrm{MCP}} $ can also be tracked quite well. However, by assessing the results of other datasets, the reliability of the estimation for the lateral motion can not be generalized. Especially where the state of $ \phi_{\mathrm{MCP}} $ changes, while the \ac{MCP} joint is additionally in flexion.\\ 
% -- ad-ab more complex
By adding the angular velocity and therefore the change over time as a parameter, some additional weaknesses of the developed system can be judged. With faster motions, the estimation results are getting worse. As already stated in \ref{sec:dataRes}, the overall system frequency for acquiring data of all four sensor units is \SI{20}{\Hz}. As further introduced in \ref{subsec:resSim}, the maximum detectable angular velocity was determined to be \SI[per-mode=symbol]{0.5}{\degree \per \second}. Some recorded datasets include very fast finger motions, by which the maximum detectable angular change is exceeded. Especially for the estimation of small motions, like the reconstruction of lateral changes, an adequate number of measurements is important. A detailed statement for the maximum detectable angular velocity is not evaluated. However, with the provided video material, this could be a future task to be determined. In the end it can be stated, that rapid or staccato like movements can not be tracked reliably and the angular velocity has an impact, due to the overall system frequency. If the states would now also be estimate in real time, the overall results are expected to worsen only marginally, because the most time consuming part would still be the sensor system.\\
%However, \todo{formulate it as \grqq the overall motion velocity, angular velocity is not allowed to be to high \grqq} when it is performed to fast, the estimation is not capable anymore of this movement. This is assumed to be on the one hand induced by the small movement range of adduction-abduction, but the main reason is the overall system frequency. Since it is with \SI{20}{\Hz} quite slow, rapid or staccato like movements can not be tracked quite well. A faster data acquisition rate would therefore lead to probably better results. So to reconstruct the motion reliably with the magnetic system, they should be performed with an adequate speed. As an additional time critical factor one could state the estimation phase. Beforehand it was stated, that a maximum duration of \todo{how fast is the worst?} seconds would not really degrade the impression of real time data. For the overall system frequency this is also true. However if the data acquisition rate could be increased, the time limiting factor would be represented by the estimation time. However, since the speed of the motions was not tracked, a detailed value for the maximum angular velocity of the motion could unfortunately not be provided.
Another, quite common observed behaviour of the system are the implausible values for $ \theta_{\mathrm{MCP}} $. Some of those peaks are exemplary discussed for set 4 (\ref{fig:bestLeap}). However, by examining other datasets, this behaviour can often be recognized in an extreme variant, where the flexion-extension angle for the \ac{MCP} joint even becomes \SI{0}{\radian} and stays at this value for some time. In set 5, such cases are detected. A sequence of the estimation results for the angles of flexion-extension is plotted in \ref{fig:set5}.
\begin{figure}[!htb]
\centering
\subfloat{\includegraphics{pictures/plots/set5.png}}\\
\subfloat{\includegraphics{pictures/statePics/set5/set5.jpg}}
\caption[Occurrence of wrong estimated states for $ \theta_{\mathrm{MCP}} $]
{The estimated results for $ \theta_{\mathrm{MCP}} $ are often wrong, if a fist is performed. The results for $ \theta_{\mathrm{PIP}} $ and $ \theta_{\mathrm{DIP}} $ show more realistic values. As soon as the intermediate and distal phalanges get to close to the palmar side, the angle of \ac{MCP} is estimated as \SI{0}{\radian}. The visualized sequence of set 5 includes two fist motions, each performed a bit different concerning speed and process. It can be stated, that a fist cannot be detected reliably, due to unsatisfied evaluations of the minimization procedure.}
\label{fig:set5}
\end{figure}
% -- set5 -> fist
In the presented figure, the errors during the performance of a fist are not only just small fluctuations anymore. Here the estimated angle of $ \theta_{\mathrm{MCP}} $ goes to \SI{0}{\radian} and also stays there, while the fingers are bent. The plot represents two sequences for the flexion and extension for a fist and back. Each sequence is performed a bit differently, concerning speed and process. But as it can be observed, at a certain angle for $ \theta_{\mathrm{PIP}} $ and $ \theta_{\mathrm{DIP}} $, the values for \ac{MCP} become 0. This behaviour comes up, because the solver cannot find a solution within the provided bounds, for the actual system configuration. This can be traced back, to the erroneous dimensions for the provided hand model. As stated beforehand, the positions and lengths of the sensors, joints and bones can only be determined by hand and therefore errors are introduced to the hand model. The minimizer tries to find a solution for a hand with exactly those erroneous provided hand dimensional values. Since they represent not exactly the real hand, the solver cannot for every sensor value a suitable system state, for solving the problem. The initialization gesture, which basically should remove the surrounding earth magnetic field and scale the values exactly for those measurement errors, is performed by only bending the \ac{MCP} joint and not the other two. For the case of bending the fingers to a fist, the false determined lengths of the bones are assumed to cause the most errors here. By regarding the results for the Leap system, also a slight inaccuracy in the state representation can be observed. The angles for the \ac{PIP} and \ac{DIP} joints are represented for each fist quite differently. At the first time, very small values are returned. The second fist movement however shows much higher values. As said, the movements were performed a bit different each time, but the differences were definitely not as high as returned by the Leap Motion. As beforehand mentioned, the occlusion of the distal bones is responsible for that. At the first bending to a fist, the bones were probably detected not as good as for the second performed motion. \\
The errors, induced by this characteristic behaviour of the magnetic system cause the main differences, compared to the almost perfect states of the Leap System. So the determination and the positioning of the sensor and hand dimensions is one of the most important parts for describing the system. The good results for set 4 can somehow be seen as a lucky coincidence, where the parameters suited best. As described \ref{sec:evalHand}, the estimation of the hand dimension did not lead to reasonable results. For the presented datasets for estimating one finger state vector by up to four sensor units, the hand dimensions are defined by the three bone lengths, the 3D joint position and the four three dimensional sensor positions. Therefore 18 values have to be measured by hand and can introduce nonlinear errors to the underlying hand dimensions. The obtained estimation results show, that the compensation of those erroneous hand model parameters by a fitting gesture can lead to reasonable results under certain conditions.

%The rapid fluctuations especially for $ \theta_{MCP} $ can be stated here. Those are also recognized in set 4, for example at \SI{20}{\second} or between \SI{30}{\second} and \SI{45}{\second}. For the other sets, these peaks are even worse and also lead sometimes to a $ \theta_{MCP} = 0 $ for a few seconds, which could be immediately be stated as false for most cases, by qualitatively looking at the video. This behaviour is observed, when a fist is performed. One set, where this effect is recognized quite often is Set 5 \todo{make plot set 5}. The estimated states for flexion-extension are plotted and the corresponding video parts are provided. It can qualitatively seen, that the states are wrong. However the angles for $ \theta_{PIP} $ and $ \theta_{DIP} $ reflect the real conditions quite good. For a performed fist, the Leap often sets those values quite low and overweights the angle for the \ac{MCP} joint. This can also be observed in \todo{figure set 5}, for example between \todo{time! 30-38 sec}. 
% -- motion velocity

\FloatBarrier	
\subsubsection{Influence of Different System Parameters}

In order to tune and improve the magnetic system for the estimation of finger poses, several methods were evaluated, based on the beforehand mentioned estimation results. As a very critical factor one can state the exact determination of the individual bone lengths, joint and sensor positions. Since those parameters are given into the equations, to represent the actual human hand, they are used by the solver, to estimate and reconstruct the measured magnetic flux densities. They are plugged in as static values and therefore have a constant nonlinear contribution to the estimated observable magnetic values. 

% Different fitting gesture
The hand dimensions are measured with a calliper. As introduced in \ref{sec:handModel}, the finger joints are assumed to have a static rotation point and the relative distance to each other is also static. Every time before measurements were recorded, the distances from the sensors to the joints are measured. Here the sensor rack is a big plus in position determination, since the locations of the sensors relative to each other are predetermined and exactly known. Furthermore, the bone lengths are measured by hand. In the end 12 bone sizes (3 for each finger), four 3D joint (one for each finger) and four 3D sensor positions (one for each sensor) have to be measured. This whole determination process is very error prone. For trying to compensate those false measured values, the initialization gesture to determine the scaling factors is introduced. By applying them to each sensor measurement one can only push the observed values into the direction of the expected results by the model. The single flexion of the \ac{MCP} joint was evaluated to serve as a repeatable motion. Also the pose of a fist was evaluated, whether it would suit the need better, since it also includes movements of the \ac{PIP} and \ac{DIP}. \ref{fig:set1mag} shows, that this is not the case. The observed magnetic fields by the sensor beneath the index finger, for a magnet located at the tip of it are displayed. The single flexion-extension of the \ac{MCP} is performed two times during \SI{3}{\second} and \SI{11}{\second}. Afterwards the finger is bended to a fist two times. From the first closed state, the motion to the straight position is performed slowly.\\
\begin{figure}[!htb]
\centering
\subfloat{\includegraphics{pictures/plots/set1mag.png}}\\
\subfloat{\includegraphics{pictures/statePics/set1mag/set1s.jpg}}
\caption[Measured magnetic flux densities for various initialization gestures]
{Sequence, showing the measured magnetic flux densities while performing two different initialization gestures. The named sensor is located beneath the index finger and the magnet is on that tip. During \SI{3}{\second} and \SI{11}{\second} only $ \theta_{\mathrm{MCP}} $ is moved. The remaining sequence shows the performance of closing and opening the fingers to a fist. While the first gesture leads to repeatable results, the second don't.}
\label{fig:set1mag}
\end{figure}
\FloatBarrier
By the development of the measured magnetic flux densities, it can be seen, that the single motion of the \ac{MCP} leads to more repeatable values, than the performance of a fist. The measurements obtained for the latter motion are highly dependent on the strength and manner of the end position. The first fist gesture shows much higher changes for the values, than the second one. Therefore the intensity of the closed hand is stronger. By looking at the simpler gesture, the two performed motion sequences look pretty much the same. Therefore the fist as initialization gesture is discarded. Like introduced in \ref{sec:evalHand} it was evaluated whether the performance along a rectangular, non-magnetic object, like a cardboard, would improve this initialization process. Therefore this gesture was performed along a cardboard before some datasets. It turned out, that the quality of the results did not increase or got even worse, by this more standardised fitting. The movement along the box and the subsequently aside putting introduces additional movements to the system. Therefore the pose of the hand changed during the calibration and the actual recording. This is critical, since the influence of the surrounding magnetic field changes due to that. Moreover, the process is performed directly over the Leap Motion controller. Since it is a vision based system, it adjusts its cameras to the surrounding light conditions. The cardboard covers the surface totally and by putting it away, the cameras have to refocus. It turned out, that if the Leap should detect a hand directly at this rescaling phase, the results are very bad or the hand even does not get detected at all. So in the end the best way for compensating the errors, induced by the hand dimensions, a gesture of single flexion-extension of \ac{MCP} has to be performed during the measurements.\\
Some of the recorded sets were also evaluated with slightly different dimensional parameters. However, no mentionable change in the results for the estimation could be observed. For estimating only a single finger by using four sensor units, the hand dimension comprises already 18 values. As presented in \ref{sec:evalHand}, tuning the measured dimensional parameters by trial and error is no option. Also the estimation of those parameters was evaluated and lead to implausible results, due to the high number of variables. 
\FloatBarrier


% Distance
As another approach, the influence of the distance from the sensors to the magnets was evaluated. For the presented datasets, the sensors were located at the back of the hand at around \SI{2}{\cm} beneath the joints. From there the corresponding bone lengths contributed, such that in full flexion, a maximum distance of around \SI{12}{\cm} was established between sensors and magnets. A few recordings were done, by placing the sensor rack at the wrist. This leads to a maximal sensor to magnet distance of around \SI{17}{\cm}. The measurable magnetic flux densities at this position, excited by the magnets at the fingertips were very low. Since the earth magnetic field cannot be eliminated reliably enough, even small motions of the hand induce errors here. The estimation results were reasonably bad.

% Earth cali
As one critical influence factor, the earth magnetic field is determined. However, the approach presented in \ref{subsec:earthEli} to overcome this showed non-satisfiable results (see \ref{subsec:resEarthEli}). To also verify this with the whole system, some experiments where executed, with different hand positions. The motions were recorded, with the hand facing different axes. This means, that the hand is also facing different orientations, compared to the Leap Controler, such as upward or downward, sideways or with the back to the camera. The results from the Leap suffered from inconsistencies, caused by occlusion of fingers or the wrist. The magnetic system, only showed reasonable results if the hand was oriented in the initial position.

% Sensor data rates
A further analysis of the sensor data acquisition rate was also evaluated. Since the system frequency for acquiring magnetic readings from all four sensors is evaluated to be \SI{20}{\Hz}, the sensor readings, which are actually sampled with \SI{50}{\Hz} are not very representable. Therefore the sampling frequency of the sensors was set at \SI{25}{\Hz}, to try to align the sensor and system frequency. However, after evaluation, the estimation results, based on the sensor data, acquired with the lower sampling rate showed the same quality as set with the higher sensor rate. Therefore, to gain the maximum possible system frequency, the sensor data rate should be put to \SI{50}{\Hz}

\FloatBarrier
\subsubsection{Concluding Observations}

Based on the presented results from the experiments, one could state that the system is dependent on a lot of variables. It can be stated, that the presented approach in combination with the utilized system cannot lead to constant and reliable results for hand pose reconstruction. In comparison to an existing camera based system, which in turn is not free of errors, the states of one finger could only be estimated with an accuracy of up to \SI{0.467}{\radian} (=\SI{26.757}{\degree}). This high difference is induced among others by not accurate determinable anatomic dimensions. The utilized hand model simplifies the natural human behaviour and constraints the range of motion in a reasonable way. However, on the real human hand, the position parameters, which are critical for the utilized model, can only be determined by hand with a caliper. Trying to reproduce the actual measurements by the hand model with error-prone position information leads to a bad model description and therefore to unsatisfying estimation results. Furthermore, the utilized models for describing the magnetic field of an artificial magnet with a certain position and orientation does not comprise the surrounding magnetic field. However, the earth field has a permanent influence on the measurements, dependent on the actual orientation, and cannot be eliminated through the presented approach. Therefore the mobility of the finger pose estimation system is highly restricted. It has to be noted, that the measurable magnetic flux density, induced by a single magnet on the fingertip, excites a field, only slightly higher, than the disturbing environment. It is evaluated, that the cylindrical bar model leads better results, than the description of the objective function with the dipole model. A fitting gesture is proposed to reduce the influence of the error-prone position and surrounding distortion factors from the measurement system. A flexion-extension about \SI{90}{\degree} of the \ac{MCP} joint is evaluated to be a reconstructible gesture for this. In the end reasonable results for the prediction where only achieved by movements, which are similar to this introduced gesture. Concerning the general solvability of the optimization problem, one can state that the system has to be overdetermined. This means that the number $ N $ of sensors, taken into account for the estimation has to be higher than the desired finger state vectors $ K $. 



